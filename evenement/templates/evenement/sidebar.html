<!-- evenement/sidebar.html -->
{% load bootstrap5 %}
{% load filters_perso %}

<div class="container-fluid">
  <div class="row flex-nowrap">
      <div class="col-auto col-md-3 col-xl-2 px-sm-2 px-0 bg-dark sidebar">
          <div class="d-flex flex-column flex-shrink-0 p-3 text-white bg-dark vh-100"
          style="padding-bottom: 4rem!important;padding-top: 4rem!important;">

            <ul class="nav nav-pills flex-column mb-auto">

              {# si un evenement, affiche la sidebar evenement #}
              {% if Evenement.UUID %}
                {# top menu #}
                {% if Administrateur or Organisateur %} 
                  <a href="#" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none"
                  data-bs-toggle="tooltip" data-bs-placement="right" title="{{ Text.nav_admin_h }}">
                    <span class="fs-4">{{ Text.nav_admin }}</span>
                  </a>
                  <hr>{# saut de section#}
                  <ul class="nav nav-pills flex-column mb-auto" id="top-menu">
                    {% if Evenement.UUID %}
                        <li class="nav-item">     
                          <form class="form evenement-form" method="get">
                            {% csrf_token %}
                            <button class="nav-link align-middle px-0"
                              data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="right" 
                              title="{{Text.nav_admin_dashboard_h}}" formaction="{% url 'dashboard' %}" onclick="loader()">
                                <i class="fs-1 bi-speedometer2"></i> <span class="ms-1 d-none d-sm-inline">{{Text.nav_admin_dashboard}}</span>
                            </button>
                          </form>
                        </li>
                    {% endif %}

                      <li class="nav-item">
                        <form class="form evenement-form" method="post">
                            <button class="nav-link align-middle px-0" 
                              data-bs-toggle="tooltip" data-bs-placement="right" title="{{Text.nav_admin_teams_h}}" onclick="loader()">
                              <i class="fs-1 bi-calendar2-plus"></i><span class="ms-1 d-none d-sm-inline">{{Text.nav_admin_teams}}</span>
                                {% csrf_token %}
                              <input  name="evenement" value="{{ Evenement.UUID }}" type="hidden">
                              <input  name="page_type" value="admin" type="hidden"> <!-- lien vers une page d'admin -->
                            </button>
                        </form>
                      </li>

                  </ul>     
                  <hr>{# saut de section#}
                  <br><br>
                  <a href="#" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none"
                  data-bs-toggle="tooltip" data-bs-placement="right" title="détails de l'évènement">
                    <span class="fs-4">{{Text.nav_event}}</span>
                  </a>
                  <hr>{# saut de section#}
                {% endif %}   

                {# menu planning & equipes #}
                <ul class="nav nav-pills flex-column mb-auto" id="menu-equipes">
                  {# planning de l evenement #}
                  <li class="nav-item">
                    <form class="form evenement-form" method="post">
                      <input type="hidden" name="planning_global" value="oui">
                      <button class="nav-link align-middle px-0" 
                        data-bs-toggle="tooltip" data-bs-placement="right" data-bs-html="true"  
                        title="{{ Text.nav_plannings_h }}<br>
                        <hr>
                        {{ Text.nav_nb_free_slots }}: <br>
                        <h3>{{ EvenementCreneauxDispo }}</h3>" 
                        onclick="loader()">
                        <i class="fs-1 bi-calendar2-range"></i><span class="ms-1 d-none d-sm-inline">{{ Text.nav_plannings }}</span>
                          {% csrf_token %}
                        <input  name="evenement" value="{{ Evenement.UUID }}" type="hidden">
                      </button>
                    </form>
                  </li>

                  {# equipes #}
                  <li class="nav-item">
                    <a href="#submenu-equipes" data-bs-toggle="collapse" class="nav-link px-0 align-middle"
                    data-bs-toggle="tooltip" data-bs-placement="right" title="{{ Text.nav_teams_h }}" >
                    <i class="fs-1 bi-people"></i> <span class="ms-1 d-none d-sm-inline">{{ Text.nav_teams }}</span>
                    </a>
                    <ul class="collapse nav flex-column ms-1" id="submenu-equipes">
                      {% for team in equipes_avec_planning %}
                        <li class="ms-3 w-100"> 
                          <a href="#submenu-{{team.UUID}}" data-bs-toggle="collapse" class="nav-link px-0 align-middle">
                            <i class="bi-people"></i> <span class="ms-1 d-none d-sm-inline"
                              {% if team.description %} data-bs-toggle="tooltip" data-bs-placement="right" title="{{team.description}}" {% endif %}>{{ team.nom|capfirst }}
                            </span>
                          </a>
                          {% for planning in  Plannings %}
                            {% if  planning.equipe == team %}
                              <ul class="collapse nav flex-column ms-1" id="submenu-{{team.UUID}}">
                                <form class="form evenement-form" method="post">
                                  {% csrf_token %}
                                  <input  name="evenement" value="{{ Evenement.UUID }}" type="hidden">
                                  <input  name="equipe" value="{{ planning.equipe_id }}" type="hidden">
                                  <input  name="planning" value="{{ planning.UUID }}" type="hidden">
                                  <button class="nav-link align-middle px-0"
                                          {% if  planning.UUID in PlanningCreneauxDispo %}
                                            data-bs-toggle="tooltip" data-bs-placement="right" data-bs-html="true" 
                                            title="{{ Text.nav_nb_free_slots }}: <br>
                                            <h3>{{ PlanningCreneauxDispo|get_item:planning.UUID }}</h3>"
                                          {% elif planning.description %}
                                            data-bs-toggle="tooltip" data-bs-placement="right" title="{{planning.description}}"
                                          {% endif %} onclick="loader()" >
                                    <i class="ms-3 bi-table"></i> <span class="ms-1 d-none d-sm-inline">{{ planning.nom }}</span>
                                  </button>
                                </form>
                              </ul>
                            {% endif %}
                          {% endfor %}
                        </li>
                      {% endfor %}
                    </ul>
                  </li>
                </ul>

              {# sinon si on a plusieurs evenement, on affiche les evenements dans la sidebar#}
              {% elif Evenements %}
                <ul class="nav nav-pills flex-column mb-auto" id="menu-equipes">
                  <a href="#" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none"
                  data-bs-toggle="tooltip" data-bs-placement="right" title="{{ Text.nav_events_asso_h }}">
                    <span class="fs-4">{{ Text.nav_events_asso }}</span>
                  </a>
                  <hr>{# saut de section#}
                  {% for event in Evenements %}
                    <li class="d-flex align-items-center pb-3 mb-md-0 me-md-auto text-white text-decoration-none">
                      <form class="form evenement-form" method="get" action="{% url 'evenement' uuid_evenement=event.UUID %}">
                        <button class="nav-link align-middle px-0" onclick="loader()">
                          <i class="bi-calendar3-event-fill"></i> <span class="ms-1 d-none d-sm-inline">{{ event.nom }}</span>
                        </button>
                      </form>
                    </li>
                  {% endfor%}
                </ul>
              {% endif %}

            </ul>
  
{# menu perso #}
            {% if user.is_authenticated %}
              <hr>{# saut de section#}
              <div class="dropdown">
                <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle " id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fs-1 bi-person-circle"></i>
                  <span class="ms-1 d-none d-sm-inline" >
                  <strong>{%if request.user.first_name%}{{ request.user.first_name|capfirst }}{%else%}{{Text.nav_my_infos}}{%endif%}</span> </a></strong>
                  </span>
                </a>
                <ul class="dropdown-menu dropdown-menu-dark text-small shadow" aria-labelledby="dropdownUser1" style="">
                  {% if Benevole and creneaux_benevole %} {# si benevole sur l evenement et des creneaux choisis, lien vers son planning#}
                    <li>
                      <form class="form evenement-form" method="post">
                        {% csrf_token %}
                        <input  name="evenement" value="{{ Evenement.UUID }}" type="hidden">
                        <input  name="equipe" value="{{ team.UUID }}" type="hidden">
                        <input type="hidden" name="planning_perso" value="oui">
                        <input type="submit" class="dropdown-item" value="{{Text.nav_planning_perso}}"
                        data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="right" title="{{Text.nav_planning_perso_h}}" onclick="loader()">
                      </form>
                    </li>
                  {% elif not Benevole and Evenement %} {# si dans un evenement mais pas benevole , propose de le devenir (cas des organisateurs) #}
                    <li>
                      <form class="form evenement-form" method="post">
                        {% csrf_token %}
                        <input  name="evenement" value="{{ Evenement.UUID }}" type="hidden">
                        <input type="hidden" name="devenir_benevole" value="">
                        <input type="submit" class="dropdown-item" value="{{Text.nav_participate}}"
                        data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="right" title="{{Text.nav_participate_h}}" onclick="loader()">
                      </form>
                    </li>
                  {% endif %}
                    <li>
                      <a href="{% url 'profile' %}?next={{ request.path|urlencode }}" class="dropdown-item">{{Text.nav_profile}}</a> 
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="{% url 'logout' %}">{{Text.nav_disconnect}}</a></li>
                </ul>
              </div>
            {% endif %}
          </div>
      </div>

{# modal d'ajout d'un planning pour les organisateurs #}
{% if Administrateur or Organisateur %} 
  {% include "evenement/modal_planning_ajoute.html" %}
{% endif %} 