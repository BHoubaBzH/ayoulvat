{% extends 'evenement/base.html' %}

{% load bootstrap5 %}

{% block evenement %}
    {% comment "haut de notre page avec les infos de l evenement" %}{% endcomment %}
    <ul class="list-group list-group-horizontal">
        <li class="list-group-item"><H1> evenement </H1></li>
        <li class="list-group-item"><H2>{{ Evenement.nom }}</H2></li>
        <li class="list-group-item">date de début : {{ Evenement.date_debut }}</li>
        <li class="list-group-item">date de fin : {{ Evenement.date_fin }}</li>
        <li class="list-group-item">ici les details de l'evenement</li>
    </ul>
    
    <br>

{% endblock evenement %}

{% block equipes %}
    <div class="list-group" id="liste_equipes_forms">
        {% for team in Equipes %}
            <form class="form evenement-form" method="post"> {# action pas selectionné donc meme self page #}
                <button class="list-group-item evenement-button 
                        {% if team.UUID_equipe|stringformat:'s' == uuid_equipe|stringformat:'s' %}active{% endif %}"
                         title={{ team.nom }}>
                    <H4>{{ team.nom }}</h4>
                        {% csrf_token %}
                        <input  name="uuid_evenement" value={{ Evenement.UUID_evenement }} type="hidden">
                        <input  name="uuid_equipe" value={{ team.UUID_equipe }} type="hidden">
                </button>
            </form>
        {% endfor %}
    </div>
{% endblock equipes %}

{% block plannings %}
    <div class="list-group" id="liste_plannings_forms">
        {% for plan in Plannings %}
            <form class="form evenement-form" method="post"> {# action pas selectionné donc meme self page #}
                <button class="list-group-item evenement-button
                        {% if plan.UUID_planning|stringformat:'s' == uuid_planning|stringformat:'s' %}active{% endif %}"
                        title={{ plan.nom }}>
                    <H4>{{ plan.nom }}</H4>
                        {% csrf_token %}
                        <input  name="uuid_evenement" value={{ Evenement.UUID_evenement }} type="hidden">
                        <input  name="uuid_equipe" value={{ Equipe.UUID_equipe }} type="hidden">
                        <input  name="uuid_planning" value={{ plan.UUID_planning }} type="hidden">
                </button>
            </form>
        {% endfor %}
    </div>
{% endblock plannings %}
{% comment "colonne poste et creneau inutile avec le planning" %}
{% block postes%}
    <div class="list-group" id="liste_postes_forms">
        {% for poste in Postes %}
            <form class="form evenement-form" method="post"> {# action pas selectionné donc meme self page #}
                <button class="list-group-item evenement-button
                        {% if poste.UUID_poste|stringformat:'s' == uuid_poste|stringformat:'s' %}active{% endif %}"
                        title={{ poste.nom }}>
                    <H4>{{ poste.nom }}</H4>
                        {% csrf_token %}
                        <input  name="uuid_evenement" value={{ Evenement.UUID_evenement }} type="hidden">
                        <input  name="uuid_equipe" value={{ Equipe.UUID_equipe }} type="hidden">
                        <input  name="uuid_planning" value={{ Planning.UUID_planning }} type="hidden">
                        <input  name="uuid_poste" value={{ poste.UUID_poste }} type="hidden">
                </button>
            </form>
        {% endfor %}
    </div>
{% endblock postes %}

{% block creneaux %}
    {% if Creneaux %}
        <ul class="list-group" id="liste_creneaux">
            {% for creno in Creneaux %}
            <il class="form evenement-form">
                {% buttons %}
                <button class="list-group-item evenement-button list-group-item-action" \
                            data-bs-toggle="collapse" \
                            data-bs-target="#collapseCreneau{{ forloop.counter }}" \
                            aria-expanded="false" \
                            aria-controls="collapseCreneau{{ forloop.counter }}">
                    {{ creno.debut|date:'H:i' }}-{{ creno.fin|date:'H:i' }}
                </button>
                {% endbuttons %}
                <div class="collapse" id="collapseCreneau{{ forloop.counter }}">
                <div class="card card-body">
                    <ul class="list-group list-group-flush" style="font-size: 0.8em">
                        <li class="list-group-item">{{ creno.nom }}</li>
                        <li class="list-group-item"><b>debut :</b> {{ creno.debut }}</li>
                        <li class="list-group-item"><b>fin :</b> {{ creno.fin }}</li>
                        {% if creno.benevole_id %}
                            <li class="list-group-item">Profile benevole uuid : {{ creno.benevole_id }}</li>
                        {% endif %}
                    </ul>
                </div>
                </div>
            </il>
            {% endfor %}
        </ul>
    {% endif %}
{% endblock creneaux %}
{% endcomment %}

{% block agenda %}
    </br>
    <H2> {{ Planning.nom }} : {{ Planning.debut|date:"d/m/Y H:i" }} - {{ Planning.fin|date:"d/m/Y H:i" }}</H2>
    {% if Postes %}
        <div class="schedule" aria-labelledby="schedule-heading">
            {# affiche les entetes des colonnes du planning : les heures #}
            {% for dates, heures in PlanningRange.items %} 
                <h2 class="time-slot" style="grid-column: time-{{ dates }}; grid-row: times">{{ heures.0 }}</h2>
            {% endfor %}
            {#les noms des postes sont insérés dans la premiere colonne nommée postes #}
            {% for poste in Postes %}
                <span class="poste-slot" aria-hidden="true" style="grid-row: poste-{{ poste.UUID_poste }}; grid-column: postes;">{{ poste.nom }}</span>
            {# pour le placement dans la grille planning garder le filtre sur creno_benevole.Creneau.debut et creno_benevole.Creneau.fin comme la fonction planning_range de views.py : #}
            {# si on a choisi un poste , on affiche les creneaux de ce poste #}
                {% for creno_benevole in Creneaux_Benevoles %}
                    {% if creno_benevole.Creneau.poste_id == poste.UUID_poste %}
                        {# affiche le creneau dans la grid ccs#} 
                        {% if creno_benevole.Creneau.benevole_id %} {# si un benevole est affecté au créneau #}
                            <div class="creneau poste poste-{{ poste.UUID_poste }}" style="grid-row: poste-{{ creno_benevole.Creneau.poste_id }}; grid-column: time-{{ creno_benevole.Creneau.debut|date:'Y-m-d-Hi' }} / time-{{ creno_benevole.Creneau.fin|date:'Y-m-d-Hi' }};">

                                {# template a insérer pour les boutons  editer/supprimer  #}
                                <div style="position:absolute; bottom:0px;right: 0px">x</div>


                            </div>
                        {% else %} {# pas de benevole affecté au créneau #}
                            <div class="creneau_libre poste poste-{{ poste.UUID_poste }}" style="grid-row: poste-{{ creno_benevole.Creneau.poste_id }}; grid-column: time-{{ creno_benevole.Creneau.debut|date:'Y-m-d-Hi' }} / time-{{ creno_benevole.Creneau.fin|date:'Y-m-d-Hi' }};">
                            </div>                        
                        {% endif %}

                        {# données du creneau affichée en mouse over #}
                        <div class="hide modal-dialog modal-sm modal-content" style="background-color: {{ poste.couleur }};">
                            <span class="poste-nom">infos : </span>
                            {# si un benevole est affecté au créneau #}
                            {% if creno_benevole.Creneau.benevole_id %}
                                {% if creno_benevole.Utilisateur.first_name or creno_benevole.Utilisateur.last_name %}
                                    <span class="poste-presenter">Bénévole : {{ creno_benevole.Utilisateur.first_name }} {{ creno_benevole.Utilisateur.last_name }}</span>
                                    {% elif creno_benevole.Utilisateur.username %}
                                    <span class="poste-presenter">Bénévole : {{ creno_benevole.Utilisateur.username }}</span>
                                {% endif %}
                                <span class="poste-presenter">Asso : {{ creno_benevole.Origine.nom }}</span>
                            {% else %} {# pas de benevole affecté au créneau #}
                                <span class="poste-presenter">Créneau Libre</span>
                            {% endif %}                           
                        </div>

                    {% endif %}
                {% endfor %}

                {# on parcour les cellule de la grid css pour y appliquer un div et une decoration css #}
                {% for dates, dateheure in PlanningRange.items %}
                    <div class="grid-cell" style="grid-row: poste-{{ poste.UUID_poste }}; grid-column: time-{{ dateheure.1|date:'Y-m-d-Hi' }};" ></div>
                {% endfor %}
            {% endfor %}
        </div>
    {% else %}
        <H3> pas encore de postes définits </H3> 
    {% endif %}
{% endblock agenda %}